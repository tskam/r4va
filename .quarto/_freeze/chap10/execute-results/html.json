{
  "hash": "00126b10d2229e00b7aa2298bef43dd9",
  "result": {
    "markdown": "---\ntitle: \"Visualising Uncertainty\"\ndate: \"12/4/2023\"\ndate-modified: \"2023-04-27\"\nformat: html\nexecute: \n  echo: true\n  eval: true\n  warning: false\n---\n\n\n## Learning Outcome\n\n## Visualizing the uncertainty of point estimates\n\n-   A point estimate is a single number, such as a mean.\n-   Uncertainty is expressed as standard error, confidence interval, or credible interval\n-   Important:\n    -   Don't confuse the uncertainty of a point estimate with the variation in the sample\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, plotly, crosstalk, DT, ggdist, gganimate)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nexam <- read_csv(\"data/Exam_data.csv\")\n```\n:::\n\n\n### Visualizing the uncertainty of point estimates: ggplot2 methods\n\nThe code chunk below performs the followings:\n\n-   group the observation by RACE,\n-   computes the count of observations, mean, standard deviation and standard error of Maths by RACE, and\n-   save the output as a tibble data table called `my_sum`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_sum <- exam %>%\n  group_by(RACE) %>%\n  summarise(\n    n=n(),\n    mean=mean(MATHS),\n    sd=sd(MATHS)\n    ) %>%\n  mutate(se=sd/sqrt(n-1))\n```\n:::\n\n\nNote: For the mathematical explanation, please refer to Slide 20 of Lesson 4.\n\nNext, the code chunk below will\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::kable(head(my_sum), format = 'html')\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> RACE </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:right;\"> mean </th>\n   <th style=\"text-align:right;\"> sd </th>\n   <th style=\"text-align:right;\"> se </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Chinese </td>\n   <td style=\"text-align:right;\"> 193 </td>\n   <td style=\"text-align:right;\"> 76.50777 </td>\n   <td style=\"text-align:right;\"> 15.69040 </td>\n   <td style=\"text-align:right;\"> 1.132357 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Indian </td>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:right;\"> 60.66667 </td>\n   <td style=\"text-align:right;\"> 23.35237 </td>\n   <td style=\"text-align:right;\"> 7.041005 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Malay </td>\n   <td style=\"text-align:right;\"> 108 </td>\n   <td style=\"text-align:right;\"> 57.44444 </td>\n   <td style=\"text-align:right;\"> 21.13478 </td>\n   <td style=\"text-align:right;\"> 2.043177 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Others </td>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 69.66667 </td>\n   <td style=\"text-align:right;\"> 10.72381 </td>\n   <td style=\"text-align:right;\"> 3.791438 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### Visualizing the uncertainty of point estimates: ggplot2 methods\n\nThe code chunk below is used to reveal the standard error of mean maths score by race.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(my_sum) +\n  geom_errorbar(\n    aes(x=RACE, \n        ymin=mean-se, \n        ymax=mean+se), \n    width=0.2, \n    colour=\"black\", \n    alpha=0.9, \n    size=0.5) +\n  geom_point(aes\n           (x=RACE, \n            y=mean), \n           stat=\"identity\", \n           color=\"red\",\n           size = 1.5,\n           alpha=1) +\n  ggtitle(\"Standard error of mean \n          maths score by rac\")\n```\n\n::: {.cell-output-display}\n![](chap10_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Visualizing the uncertainty of point estimates: **ggplot2** methods\n\n::: callout-note\n### Your turn\n\nPlot the 95% confidence interval of mean maths score by race. The error bars should be sorted by the average maths scores.\n:::\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](chap10_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### Visualizing the uncertainty of point estimates with interactive error bars\n\n::: callout-note\n### Your turn\n\nPlot interactive error bars for the 99% confidence interval of mean maths score by race.\n:::\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"container-fluid crosstalk-bscols\">\n<div class=\"row\">\n<div class=\"col-xs-4\">\n<div class=\"plotly html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-f8321db8a096d36d904a\" style=\"width:100%;height:400px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f8321db8a096d36d904a\">{\"x\":{\"data\":[{\"x\":[1,3,4,2],\"y\":[76.5077720207254,60.6666666666667,57.4444444444444,69.6666666666667],\"text\":\"\",\"key\":[\"1\",\"2\",\"3\",\"4\"],\"type\":\"scatter\",\"mode\":\"lines\",\"opacity\":0.9,\"line\":{\"color\":\"transparent\"},\"error_y\":{\"array\":[2.92148180332821,18.1657940296391,5.2713960499886,9.78190932282649],\"arrayminus\":[2.92148180332821,18.1657940296391,5.2713960499886,9.7819093228265],\"type\":\"data\",\"width\":21.3333333333334,\"symmetric\":false,\"color\":\"rgba(0,0,0,1)\"},\"set\":\"SharedData61eff23a\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"_isNestedKey\":false,\"frame\":null},{\"x\":[1,3,4,2],\"y\":[76.5077720207254,60.6666666666667,57.4444444444444,69.6666666666667],\"text\":[\"Race: Chinese <br>N: 193 <br>Avg. Scores: 76.51 <br>95% CI:[ 73.59 , 79.43 ]\",\"Race: Indian <br>N: 12 <br>Avg. Scores: 60.67 <br>95% CI:[ 42.5 , 78.83 ]\",\"Race: Malay <br>N: 108 <br>Avg. Scores: 57.44 <br>95% CI:[ 52.17 , 62.72 ]\",\"Race: Others <br>N: 9 <br>Avg. Scores: 69.67 <br>95% CI:[ 59.88 , 79.45 ]\"],\"key\":[\"1\",\"2\",\"3\",\"4\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(255,0,0,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(255,0,0,1)\"}},\"hoveron\":\"points\",\"set\":\"SharedData61eff23a\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"_isNestedKey\":false,\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.7625570776256,\"r\":7.30593607305936,\"b\":50.8458187739088,\"l\":37.2602739726027},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"title\":{\"text\":\"99% Confidence interval of average /<br>maths scores by race\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":17.5342465753425},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.4,4.6],\"tickmode\":\"array\",\"ticktext\":[\"Chinese\",\"Others\",\"Indian\",\"Malay\"],\"tickvals\":[1,2,3,4],\"categoryorder\":\"array\",\"categoryarray\":[\"Chinese\",\"Others\",\"Indian\",\"Malay\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-45,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"Race\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[40.6534874694042,81.2959611571165],\"tickmode\":\"array\",\"ticktext\":[\"50\",\"60\",\"70\",\"80\"],\"tickvals\":[50,60,70,80],\"categoryorder\":\"array\",\"categoryarray\":[\"50\",\"60\",\"70\",\"80\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"Average Scores\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895}},\"hovermode\":\"closest\",\"barmode\":\"relative\",\"dragmode\":\"zoom\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"49dc22122dd4\":{\"x\":{},\"ymin\":{},\"ymax\":{},\"type\":\"scatter\"},\"49dcbc16896\":{\"x\":{},\"y\":{},\"text\":{}}},\"cur_data\":\"49dc22122dd4\",\"visdat\":{\"49dc22122dd4\":[\"function (y) \",\"x\"],\"49dcbc16896\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0,\"ctGroups\":[\"SharedData61eff23a\"]},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n</div>\n<div class=\"col-xs-8\">\n<div id=\"htmlwidget-68993c7317b44a0fc3b8\" style=\"width:100%;height:auto;\" class=\"datatables html-widget \"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-68993c7317b44a0fc3b8\">{\"x\":{\"crosstalkOptions\":{\"key\":[\"1\",\"2\",\"3\",\"4\"],\"group\":\"SharedData61eff23a\"},\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Chinese\",\"Indian\",\"Malay\",\"Others\"],[193,12,108,9],[76.5077720207254,60.6666666666667,57.4444444444444,69.6666666666667],[15.6904028426431,23.3523731841827,21.1347847806846,10.7238052947636],[1.1323572881117,7.04100543784463,2.04317676356147,3.79143772202577]],\"container\":\"<table class=\\\"compact\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>No. of pupils<\\/th>\\n      <th>Avg Scores<\\/th>\\n      <th>Std Dev<\\/th>\\n      <th>Std Error<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":10,\"scrollX\":true,\"columnDefs\":[{\"targets\":2,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":3,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":4,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[1,2,3,4]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\"],\"jsHooks\":[]}</script>\n</div>\n</div>\n</div>\n```\n:::\n:::\n\n\n## Visualising Uncertainty: **ggdist** package\n\n-   [**ggdist**](https://mjskay.github.io/ggdist/index.html) is an R package that provides a flexible set of ggplot2 geoms and stats designed especially for visualising distributions and uncertainty.\n-   It is designed for both frequentist and Bayesian uncertainty visualization, taking the view that uncertainty visualization can be unified through the perspective of distribution visualization:\n    -   for frequentist models, one visualises confidence distributions or bootstrap distributions (see vignette(\"freq-uncertainty-vis\"));\n    -   for Bayesian models, one visualises probability distributions (see the tidybayes package, which builds on top of ggdist).\n\n![](img/ggdist.png)\n\n### Visualizing the uncertainty of point estimates: **ggdist** methods\n\nIn the code chunk below, [`stat_pointinterval()`](https://mjskay.github.io/ggdist/reference/stat_pointinterval.html) of **ggdist** is used to build a visual for displaying distribution of maths scores by race.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexam %>%\n  ggplot(aes(x = RACE, \n             y = MATHS)) +\n  stat_pointinterval() +   #<<\n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Mean Point + Multiple-interval plot\")\n```\n\n::: {.cell-output-display}\n![](chap10_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nGentle advice: This function comes with many arguments, students are advised to read the syntax reference for more detail.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexam %>%\n  ggplot(aes(x = RACE, y = MATHS)) +\n  stat_pointinterval(.width = 0.95,\n  .point = median,\n  .interval = qi) +\n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Mean Point + Multiple-interval plot\")\n```\n\n::: {.cell-output-display}\n![](chap10_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Visualizing the uncertainty of point estimates: **ggdist** methods\n\n::: callout-note\n### Your turn\n\nMakeover the plot on previous slide by showing 95% and 99% confidence intervals.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexam %>%\n  ggplot(aes(x = RACE, \n             y = MATHS)) +\n  stat_pointinterval(\n    show.legend = FALSE) +   \n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Mean Point + Multiple-interval plot\")\n```\n\n::: {.cell-output-display}\n![](chap10_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nGentle advice: This function comes with many arguments, students are advised to read the syntax reference for more detail.\n\n### Visualizing the uncertainty of point estimates: **ggdist** methods\n\nIn the code chunk below, [`stat_gradientinterval()`](https://mjskay.github.io/ggdist/reference/stat_gradientinterval.html) of **ggdist** is used to build a visual for displaying distribution of maths scores by race.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexam %>%\n  ggplot(aes(x = RACE, \n             y = MATHS)) +\n  stat_gradientinterval(   \n    fill = \"skyblue\",      \n    show.legend = TRUE     \n  ) +                        \n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Gradient + interval plot\")\n```\n\n::: {.cell-output-display}\n![](chap10_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nGentle advice: This function comes with many arguments, students are advised to read the syntax reference for more detail.\n\n## Visualising Uncertainty with Hypothetical Outcome Plots (HOPs)\n\nStep 1: Installing ungeviz package\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndevtools::install_github(\"wilkelab/ungeviz\")\n```\n:::\n\n\nNote: You only need to perform this step once.\n\nStep 2: Launch the application in R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ungeviz)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = exam, \n       (aes(x = factor(RACE), y = MATHS))) +\n  geom_point(position = position_jitter(\n    height = 0.3, width = 0.05), \n    size = 0.4, color = \"#0072B2\", alpha = 1/2) +\n  geom_hpline(data = sampler(25, group = RACE), height = 0.6, color = \"#D55E00\") +\n  theme_bw() + \n  # `.draw` is a generated column indicating the sample draw\n  transition_states(.draw, 1, 3)\n```\n\n::: {.cell-output-display}\n![](chap10_files/figure-html/unnamed-chunk-14-1.gif)\n:::\n:::\n\n\n## Visualising Uncertainty with Hypothetical Outcome Plots (HOPs)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = exam, \n       (aes(x = factor(RACE), \n            y = MATHS))) +\n  geom_point(position = position_jitter(\n    height = 0.3, \n    width = 0.05), \n    size = 0.4, \n    color = \"#0072B2\", \n    alpha = 1/2) +\n  geom_hpline(data = sampler(25, \n                             group = RACE), \n              height = 0.6, \n              color = \"#D55E00\") +\n  theme_bw() + \n  transition_states(.draw, 1, 3)\n```\n\n::: {.cell-output-display}\n![](chap10_files/figure-html/unnamed-chunk-15-1.gif)\n:::\n:::\n",
    "supporting": [
      "chap10_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\r\n<script src=\"site_libs/plotly-binding-4.10.1/plotly.js\"></script>\r\n<script src=\"site_libs/typedarray-0.1/typedarray.min.js\"></script>\r\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\r\n<link href=\"site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\r\n<link href=\"site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\r\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/datatables-binding-0.27/datatables.js\"></script>\r\n<link href=\"site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\r\n<link href=\"site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js\"></script>\r\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n<link href=\"site_libs/bootstrap-grid-3.4.1/bootstrap-grid.min.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}