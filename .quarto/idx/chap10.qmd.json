{"title":"Visualising Uncertainty","markdown":{"yaml":{"title":"Visualising Uncertainty","date":"12/4/2023","date-modified":"`r Sys.Date()`","format":"html","execute":{"echo":true,"eval":true,"warning":false}},"headingText":"Learning Outcome","containsRefs":false,"markdown":"\n\n\nVisualising uncertainty is relatively new in statistical graphics.  In this chapter, you will gain hands-on experience on creating statistical graphics for visualising uncertainty.  By the end of this chapter you will be able:\n\n- to plot statistics error bars by using ggplot2,\n- to plot interactive error bars by combining ggplot2, plotly and DT,\n- to create advanced by using ggdist, and\n- to create hypothetical outcome plots (HOPs) by using ungeviz package. \n\n\n## Getting Started\n\n### Installing and loading the packages\n\nFor the purpose of this exercise, the following R packages will be used, they are:\n\n- tidyverse, a family of R packages for data science process,\n- plotly for creating interactive plot,\n- gganimate for creating animation plot,\n- DT for displaying interactive html table,\n- crosstalk for for implementing cross-widget interactions (currently, linked brushing and filtering), and\n- ggdist for visualising distribution and uncertainty.\n\n```{r}\npacman::p_load(ungeviz, plotly, crosstalk,\n               DT, ggdist, gganimate, tidyverse)\n```\n\n### Data import\n\nFor the purpose of this exercise, *Exam_data.csv* will be used.\n\n```{r}\nexam <- read_csv(\"data/Exam_data.csv\")\n```\n\n### Visualizing the uncertainty of point estimates: ggplot2 methods\n\nA point estimate is a single number, such as a mean. Uncertainty, on the other hand, is expressed as standard error, confidence interval, or credible interval.\n\n::: callout-important\n- Don't confuse the uncertainty of a point estimate with the variation in the sample\n:::\n\nIn this section, you will learn how to plot error bars of maths scores by race by using data provided in *exam* tibble data frame.  \n\nFirstly, code chunk below will be used to derive the necessary summary statistics.  \n\n```{r}\nmy_sum <- exam %>%\n  group_by(RACE) %>%\n  summarise(\n    n=n(),\n    mean=mean(MATHS),\n    sd=sd(MATHS)\n    ) %>%\n  mutate(se=sd/sqrt(n-1))\n```\n\n::: callout-tip\n### What can you learn from the code chunk above?\n-   `group_by()` of **dplyr** package is used to group the observation by RACE,\n-   `summarise()` is used to compute the count of observations, mean, standard deviation \n-   `mutate()` is used to derive standard error of Maths by RACE, and\n-   the output is save as a tibble data table called *my_sum*.\n:::\n\n::: callout-note\nFor the mathematical explanation, please refer to Slide 20 of Lesson 4.\n:::\n\nNext, the code chunk below will be used to display *my_sum* tibble data frame in an html table format.\n\n::: panel-tabset\n## The code chunk\n```{r}\n#| eval: false\nknitr::kable(head(my_sum), format = 'html')\n```\n\n## The table\n\n```{r}\n#| echo: false\nknitr::kable(head(my_sum), format = 'html')\n```\n:::\n\n### Visualizing the uncertainty of point estimates: ggplot2 methods\n\nThe code chunk below is used to reveal the standard error of mean maths score by race.\n\n```{r}\nggplot(my_sum) +\n  geom_errorbar(\n    aes(x=RACE, \n        ymin=mean-se, \n        ymax=mean+se), \n    width=0.2, \n    colour=\"black\", \n    alpha=0.9, \n    size=0.5) +\n  geom_point(aes\n           (x=RACE, \n            y=mean), \n           stat=\"identity\", \n           color=\"red\",\n           size = 1.5,\n           alpha=1) +\n  ggtitle(\"Standard error of mean \n          maths score by rac\")\n```\n\n::: callout-note\n### Your turn\nPlot the 95% confidence interval of mean maths score by race. The error bars should be sorted by the average maths scores.\n:::\n\n::: panel-tabset\n## The plot\n\n```{r}\n#| echo: false\nggplot(my_sum) +\n  geom_errorbar(\n    aes(x=reorder(RACE, -mean), \n        ymin=mean-1.96*se, \n        ymax=mean+1.96*se), \n    width=0.2, \n    colour=\"black\", \n    alpha=0.9, \n    size=0.5) +\n  geom_point(aes\n           (x=RACE, \n            y=mean), \n           stat=\"identity\", \n           color=\"red\",\n           size = 1.5,\n           alpha=1) +\n  ggtitle(\"95% confidence interval of mean maths score by race\")\n```\n\n## The code chunk\n```{r}\n#| eval: false\nggplot(my_sum) +\n  geom_errorbar(\n    aes(x=reorder(RACE, -mean), \n        ymin=mean-1.96*se, \n        ymax=mean+1.96*se), \n    width=0.2, \n    colour=\"black\", \n    alpha=0.9, \n    size=0.5) +\n  geom_point(aes\n           (x=RACE, \n            y=mean), \n           stat=\"identity\", \n           color=\"red\",\n           size = 1.5,\n           alpha=1) +\n  ggtitle(\"95% confidence interval of mean maths score by race\")\n```\n:::\n\n### Visualizing the uncertainty of point estimates with interactive error bars\n\n::: callout-note\n### Your turn\nPlot interactive error bars for the 99% confidence interval of mean maths score by race.\n:::\n\n::: panel-tabset\n## The plot\n```{r}\n#| echo: false\nshared_df = SharedData$new(my_sum)\n\nbscols(widths = c(5,7),\n\nggplotly((ggplot(shared_df) +\n            geom_errorbar(aes(x=reorder(RACE, -mean), ymin=mean-2.58*se, ymax=mean+2.58*se), width=0.2, colour=\"black\", alpha=0.9, size=0.5) +\n            geom_point(aes (x=RACE, y=mean, text = paste(\"Race:\", `RACE`,\"<br>N:\", `n`,\"<br>Avg. Scores:\", round(mean, digits = 2),\"<br>95% CI:[\", round((mean-2.58*se), digits = 2), \",\", round((mean+2.58*se), digits = 2),\"]\")), stat=\"identity\", color=\"red\", size = 1.5, alpha=1) + xlab(\"Race\") + ylab(\"Average Scores\") + theme_minimal() + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1)) + ggtitle(\"99% Confidence interval of average /<br>maths scores by race\")), tooltip = \"text\"), DT::datatable(shared_df, rownames = FALSE, class=\"compact\", width=\"90%\", options = list(pageLength = 10, scrollX=T), colnames = c(\"No. of pupils\", \"Avg Scores\",\"Std Dev\",\"Std Error\")) %>%\n  formatRound(columns=c('mean', 'sd', 'se'), digits=2) \n)\n\n```\n\n## The code chunk\n```{r}\n#| eval: false\nshared_df = SharedData$new(my_sum)\n\nbscols(widths = c(4,8),\n       ggplotly((ggplot(shared_df) +\n                   geom_errorbar(aes(\n                     x=reorder(RACE, -mean),\n                     ymin=mean-2.58*se, \n                     ymax=mean+2.58*se), \n                     width=0.2, \n                     colour=\"black\", \n                     alpha=0.9, \n                     size=0.5) +\n                   geom_point(aes(\n                     x=RACE, \n                     y=mean, \n                     text = paste(\"Race:\", `RACE`, \n                                  \"<br>N:\", `n`,\n                                  \"<br>Avg. Scores:\", round(mean, digits = 2),\n                                  \"<br>95% CI:[\", \n                                  round((mean-2.58*se), digits = 2), \",\",\n                                  round((mean+2.58*se), digits = 2),\"]\")),\n                     stat=\"identity\", \n                     color=\"red\", \n                     size = 1.5, \n                     alpha=1) + \n                   xlab(\"Race\") + \n                   ylab(\"Average Scores\") + \n                   theme_minimal() + \n                   theme(axis.text.x = element_text(\n                     angle = 45, vjust = 0.5, hjust=1)) +\n                   ggtitle(\"99% Confidence interval of average /<br>maths scores by race\")), \n                tooltip = \"text\"), \n       DT::datatable(shared_df, \n                     rownames = FALSE, \n                     class=\"compact\", \n                     width=\"100%\", \n                     options = list(pageLength = 10,\n                                    scrollX=T), \n                     colnames = c(\"No. of pupils\", \n                                  \"Avg Scores\",\n                                  \"Std Dev\",\n                                  \"Std Error\")) %>%\n         formatRound(columns=c('mean', 'sd', 'se'),\n                     digits=2))\n```\n:::\n\n## Visualising Uncertainty: **ggdist** package\n\n-   [**ggdist**](https://mjskay.github.io/ggdist/index.html) is an R package that provides a flexible set of ggplot2 geoms and stats designed especially for visualising distributions and uncertainty.\n-   It is designed for both frequentist and Bayesian uncertainty visualization, taking the view that uncertainty visualization can be unified through the perspective of distribution visualization:\n    -   for frequentist models, one visualises confidence distributions or bootstrap distributions (see vignette(\"freq-uncertainty-vis\"));\n    -   for Bayesian models, one visualises probability distributions (see the tidybayes package, which builds on top of ggdist).\n\n![](chap10/img/ggdist.png)\n\n### Visualizing the uncertainty of point estimates: **ggdist** methods\n\nIn the code chunk below, [`stat_pointinterval()`](https://mjskay.github.io/ggdist/reference/stat_pointinterval.html) of **ggdist** is used to build a visual for displaying distribution of maths scores by race.\n\n```{r}\nexam %>%\n  ggplot(aes(x = RACE, \n             y = MATHS)) +\n  stat_pointinterval() +   #<<\n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Mean Point + Multiple-interval plot\")\n```\n\nGentle advice: This function comes with many arguments, students are advised to read the syntax reference for more detail.\n\n```{r}\nexam %>%\n  ggplot(aes(x = RACE, y = MATHS)) +\n  stat_pointinterval(.width = 0.95,\n  .point = median,\n  .interval = qi) +\n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Mean Point + Multiple-interval plot\")\n```\n\n### Visualizing the uncertainty of point estimates: **ggdist** methods\n\n::: callout-note\n### Your turn\n\nMakeover the plot on previous slide by showing 95% and 99% confidence intervals.\n:::\n\n```{r}\nexam %>%\n  ggplot(aes(x = RACE, \n             y = MATHS)) +\n  stat_pointinterval(\n    show.legend = FALSE) +   \n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Mean Point + Multiple-interval plot\")\n```\n\nGentle advice: This function comes with many arguments, students are advised to read the syntax reference for more detail.\n\n### Visualizing the uncertainty of point estimates: **ggdist** methods\n\nIn the code chunk below, [`stat_gradientinterval()`](https://mjskay.github.io/ggdist/reference/stat_gradientinterval.html) of **ggdist** is used to build a visual for displaying distribution of maths scores by race.\n\n```{r}\nexam %>%\n  ggplot(aes(x = RACE, \n             y = MATHS)) +\n  stat_gradientinterval(   \n    fill = \"skyblue\",      \n    show.legend = TRUE     \n  ) +                        \n  labs(\n    title = \"Visualising confidence intervals of mean math score\",\n    subtitle = \"Gradient + interval plot\")\n```\n\nGentle advice: This function comes with many arguments, students are advised to read the syntax reference for more detail.\n\n## Visualising Uncertainty with Hypothetical Outcome Plots (HOPs)\n\nStep 1: Installing ungeviz package\n\n```{r eval=FALSE}\ndevtools::install_github(\"wilkelab/ungeviz\")\n```\n\nNote: You only need to perform this step once.\n\nStep 2: Launch the application in R\n\n```{r}\nlibrary(ungeviz)\n```\n\n```{r}\nggplot(data = exam, \n       (aes(x = factor(RACE), y = MATHS))) +\n  geom_point(position = position_jitter(\n    height = 0.3, width = 0.05), \n    size = 0.4, color = \"#0072B2\", alpha = 1/2) +\n  geom_hpline(data = sampler(25, group = RACE), height = 0.6, color = \"#D55E00\") +\n  theme_bw() + \n  # `.draw` is a generated column indicating the sample draw\n  transition_states(.draw, 1, 3)\n\n```\n\n## Visualising Uncertainty with Hypothetical Outcome Plots (HOPs)\n\n```{r}\nggplot(data = exam, \n       (aes(x = factor(RACE), \n            y = MATHS))) +\n  geom_point(position = position_jitter(\n    height = 0.3, \n    width = 0.05), \n    size = 0.4, \n    color = \"#0072B2\", \n    alpha = 1/2) +\n  geom_hpline(data = sampler(25, \n                             group = RACE), \n              height = 0.6, \n              color = \"#D55E00\") +\n  theme_bw() + \n  transition_states(.draw, 1, 3)\n```\n\n```{r}\n#| eval: false\n#| echo: false\nrenderthis::to_pdf(from = \"https://r4va.netlify.app/chap10.html\",\n                   to = \"D://ISSS608_AY2022-23Apr/20-r4va/chap10.pdf\")\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"chap10.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.335","bibliography":["references.bib"],"editor":"visual","theme":"cosmo","title":"Visualising Uncertainty","date":"12/4/2023","date-modified":"`r Sys.Date()`"},"extensions":{"book":{"multiFile":true}}},"pdf":{"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"chap10.pdf"},"language":{},"metadata":{"block-headings":true,"bibliography":["references.bib"],"editor":"visual","documentclass":"scrreprt","title":"Visualising Uncertainty","date":"12/4/2023","date-modified":"`r Sys.Date()`"},"extensions":{"book":{}}}}}